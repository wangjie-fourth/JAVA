{"index":{"version":"0.5.12","fields":[{"name":"title","boost":10},{"name":"keywords","boost":15},{"name":"body","boost":1}],"ref":"url","documentStore":{"store":{"./":["introduct"],"multithreading/synchronized在jdk1.6的优化.html":["\"test\"","(ljava/lang/string;)v","(lock){","(this){","...","//","0;","1","15","16","1、加synchronized跟不加有什么区别","2、进入monitorenter的时候，一定需要获取监视器吗？离开monitorexit的时候，一定要释放监视器吗？","3、锁粗化、锁细化：编译器层面的优化",":","=","aload","foo(){","for(int","getstat","invokevirtu","java/io/printstream.println","java/lang/system.out","l0","l5","ldc","linenumb","ljava/io/printstream;","lock","lock;","monitorent","monitorexit","new","object","object();","public","return","static","synchron","synchronized在jdk1.6的优化","system.out.println(\"test\");","test()v","test(){","void","}","以下是某个对象头锁的膨胀过程：","但是在jdk1.6之前，这种锁运行性能不高。因为synchronized是一种重量级别锁得实现。而在jdk1.6后，java就用了一堆其他操作来提供锁性能的操作。","但是如果这个锁对象逃出去的话，就不会产生锁消除。比如：","偏向锁：一直以来都是同一个线程获取这个对象，则这个对象头就变成偏向锁；如果下次还是这个线程获取我，也不需要去获取monitor","其中，monitor就是监视器。","其字节码上会多出俩个命令","加synchronized就是加锁。对应java中，就是对应的监视器。对应在字节码上的区别：","即：monitorexit和monitorenter指令。","在java之前，没有什么语言提供加锁得语言级别得支持。也就是说之前c、c++都是要引用第三方类库来达到加锁得功能。所以java一出生就具有这种功能，让它备受瞩目。","在jvm中，每个对象包含俩部分：对象头、对象数据。其中对象数据就是我们写代码能看到的属性之类的东西，而在对象头中含有包含同步相关信息。","如果同一个锁要连续频繁加锁、解锁，就会粗坏为更大范围的锁。比如：","对象头中就包含了记录锁的标志位。如下图：","对象头的定义","对象的对象头的碰撞过程，其实是多线程环境中，针对不同环境下，对象头变化的过程。","无锁：没有任何线程争抢这个对象，则这个对象头就变成无锁状态；只要有线程来，不需要获取monitor，直接用","答案是不一定。这就是因为jdk1.6所做的优化。","经过逃逸分析，发现不可能有其他线程跟我竞争锁，就会把这个锁消除掉。比如：","而在jdk1.6，对锁进行处理。认为在某些情况下，是不需要获取锁也可以达到线程安全目的，在特定情况下，再让线程获取锁。这就是锁的膨胀过程。","轻量锁：有多个线程竞争的情况发生，但在绝大多数情况下，在任何时刻，都只有一个线程来获取这个锁。则这个对象头就变成轻量锁；此时，只要你获取这个对象，就直接用，不需要获取monitor","重量锁：在同一时刻，有多个线程在同时竞争锁。这个时候就必须要获取monitor","锁膨胀的过程","（1）锁粗坏","（2）锁消除"]},"length":2},"tokenStore":{"root":{"0":{"docs":{},";":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}},"1":{"5":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}},"6":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}},"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}},"、":{"docs":{},"加":{"docs":{},"s":{"docs":{},"y":{"docs":{},"n":{"docs":{},"c":{"docs":{},"h":{"docs":{},"r":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"z":{"docs":{},"e":{"docs":{},"d":{"docs":{},"跟":{"docs":{},"不":{"docs":{},"加":{"docs":{},"有":{"docs":{},"什":{"docs":{},"么":{"docs":{},"区":{"docs":{},"别":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}},"2":{"docs":{},"、":{"docs":{},"进":{"docs":{},"入":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{},"e":{"docs":{},"n":{"docs":{},"t":{"docs":{},"e":{"docs":{},"r":{"docs":{},"的":{"docs":{},"时":{"docs":{},"候":{"docs":{},"，":{"docs":{},"一":{"docs":{},"定":{"docs":{},"需":{"docs":{},"要":{"docs":{},"获":{"docs":{},"取":{"docs":{},"监":{"docs":{},"视":{"docs":{},"器":{"docs":{},"吗":{"docs":{},"？":{"docs":{},"离":{"docs":{},"开":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{},"e":{"docs":{},"x":{"docs":{},"i":{"docs":{},"t":{"docs":{},"的":{"docs":{},"时":{"docs":{},"候":{"docs":{},"，":{"docs":{},"一":{"docs":{},"定":{"docs":{},"要":{"docs":{},"释":{"docs":{},"放":{"docs":{},"监":{"docs":{},"视":{"docs":{},"器":{"docs":{},"吗":{"docs":{},"？":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"3":{"docs":{},"、":{"docs":{},"锁":{"docs":{},"粗":{"docs":{},"化":{"docs":{},"、":{"docs":{},"锁":{"docs":{},"细":{"docs":{},"化":{"docs":{},"：":{"docs":{},"编":{"docs":{},"译":{"docs":{},"器":{"docs":{},"层":{"docs":{},"面":{"docs":{},"的":{"docs":{},"优":{"docs":{},"化":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}},"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{},"r":{"docs":{},"o":{"docs":{},"d":{"docs":{},"u":{"docs":{},"c":{"docs":{},"t":{"docs":{"./":{"ref":"./","tf":11}}}}}}}}},"v":{"docs":{},"o":{"docs":{},"k":{"docs":{},"e":{"docs":{},"v":{"docs":{},"i":{"docs":{},"r":{"docs":{},"t":{"docs":{},"u":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}},"\"":{"docs":{},"t":{"docs":{},"e":{"docs":{},"s":{"docs":{},"t":{"docs":{},"\"":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}},"(":{"docs":{},"l":{"docs":{},"j":{"docs":{},"a":{"docs":{},"v":{"docs":{},"a":{"docs":{},"/":{"docs":{},"l":{"docs":{},"a":{"docs":{},"n":{"docs":{},"g":{"docs":{},"/":{"docs":{},"s":{"docs":{},"t":{"docs":{},"r":{"docs":{},"i":{"docs":{},"n":{"docs":{},"g":{"docs":{},";":{"docs":{},")":{"docs":{},"v":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},")":{"docs":{},"{":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}}}}}},"t":{"docs":{},"h":{"docs":{},"i":{"docs":{},"s":{"docs":{},")":{"docs":{},"{":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}},".":{"docs":{},".":{"docs":{},".":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.0425531914893617}}}}},"/":{"docs":{},"/":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}},":":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}},"=":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.031914893617021274}}},"a":{"docs":{},"l":{"docs":{},"o":{"docs":{},"a":{"docs":{},"d":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}},"f":{"docs":{},"o":{"docs":{},"o":{"docs":{},"(":{"docs":{},")":{"docs":{},"{":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}}}},"r":{"docs":{},"(":{"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}},"g":{"docs":{},"e":{"docs":{},"t":{"docs":{},"s":{"docs":{},"t":{"docs":{},"a":{"docs":{},"t":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}},"j":{"docs":{},"a":{"docs":{},"v":{"docs":{},"a":{"docs":{},"/":{"docs":{},"i":{"docs":{},"o":{"docs":{},"/":{"docs":{},"p":{"docs":{},"r":{"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{},"s":{"docs":{},"t":{"docs":{},"r":{"docs":{},"e":{"docs":{},"a":{"docs":{},"m":{"docs":{},".":{"docs":{},"p":{"docs":{},"r":{"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{},"l":{"docs":{},"n":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}},"l":{"docs":{},"a":{"docs":{},"n":{"docs":{},"g":{"docs":{},"/":{"docs":{},"s":{"docs":{},"y":{"docs":{},"s":{"docs":{},"t":{"docs":{},"e":{"docs":{},"m":{"docs":{},".":{"docs":{},"o":{"docs":{},"u":{"docs":{},"t":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}},"l":{"0":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}},"5":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}},"docs":{},"d":{"docs":{},"c":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}},"i":{"docs":{},"n":{"docs":{},"e":{"docs":{},"n":{"docs":{},"u":{"docs":{},"m":{"docs":{},"b":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}}}}}}},"j":{"docs":{},"a":{"docs":{},"v":{"docs":{},"a":{"docs":{},"/":{"docs":{},"i":{"docs":{},"o":{"docs":{},"/":{"docs":{},"p":{"docs":{},"r":{"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{},"s":{"docs":{},"t":{"docs":{},"r":{"docs":{},"e":{"docs":{},"a":{"docs":{},"m":{"docs":{},";":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}},";":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{},"e":{"docs":{},"n":{"docs":{},"t":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}},"x":{"docs":{},"i":{"docs":{},"t":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}},"n":{"docs":{},"e":{"docs":{},"w":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}}},"o":{"docs":{},"b":{"docs":{},"j":{"docs":{},"e":{"docs":{},"c":{"docs":{},"t":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.031914893617021274}},"(":{"docs":{},")":{"docs":{},";":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}}}}}}}}},"p":{"docs":{},"u":{"docs":{},"b":{"docs":{},"l":{"docs":{},"i":{"docs":{},"c":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.0425531914893617}}}}}}}},"r":{"docs":{},"e":{"docs":{},"t":{"docs":{},"u":{"docs":{},"r":{"docs":{},"n":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}},"s":{"docs":{},"t":{"docs":{},"a":{"docs":{},"t":{"docs":{},"i":{"docs":{},"c":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}}}}},"y":{"docs":{},"n":{"docs":{},"c":{"docs":{},"h":{"docs":{},"r":{"docs":{},"o":{"docs":{},"n":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.031914893617021274}},"i":{"docs":{},"z":{"docs":{},"e":{"docs":{},"d":{"docs":{},"在":{"docs":{},"j":{"docs":{},"d":{"docs":{},"k":{"1":{"docs":{},".":{"6":{"docs":{},"的":{"docs":{},"优":{"docs":{},"化":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":10}}}}}},"docs":{}}},"docs":{}}}}}}}}}}}}}}},"s":{"docs":{},"t":{"docs":{},"e":{"docs":{},"m":{"docs":{},".":{"docs":{},"o":{"docs":{},"u":{"docs":{},"t":{"docs":{},".":{"docs":{},"p":{"docs":{},"r":{"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{},"l":{"docs":{},"n":{"docs":{},"(":{"docs":{},"\"":{"docs":{},"t":{"docs":{},"e":{"docs":{},"s":{"docs":{},"t":{"docs":{},"\"":{"docs":{},")":{"docs":{},";":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"t":{"docs":{},"e":{"docs":{},"s":{"docs":{},"t":{"docs":{},"(":{"docs":{},")":{"docs":{},"v":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}},"{":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}},"v":{"docs":{},"o":{"docs":{},"i":{"docs":{},"d":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.02127659574468085}}}}}},"}":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.06382978723404255}}},"以":{"docs":{},"下":{"docs":{},"是":{"docs":{},"某":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"锁":{"docs":{},"的":{"docs":{},"膨":{"docs":{},"胀":{"docs":{},"过":{"docs":{},"程":{"docs":{},"：":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}},"但":{"docs":{},"是":{"docs":{},"在":{"docs":{},"j":{"docs":{},"d":{"docs":{},"k":{"1":{"docs":{},".":{"6":{"docs":{},"之":{"docs":{},"前":{"docs":{},"，":{"docs":{},"这":{"docs":{},"种":{"docs":{},"锁":{"docs":{},"运":{"docs":{},"行":{"docs":{},"性":{"docs":{},"能":{"docs":{},"不":{"docs":{},"高":{"docs":{},"。":{"docs":{},"因":{"docs":{},"为":{"docs":{},"s":{"docs":{},"y":{"docs":{},"n":{"docs":{},"c":{"docs":{},"h":{"docs":{},"r":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"z":{"docs":{},"e":{"docs":{},"d":{"docs":{},"是":{"docs":{},"一":{"docs":{},"种":{"docs":{},"重":{"docs":{},"量":{"docs":{},"级":{"docs":{},"别":{"docs":{},"锁":{"docs":{},"得":{"docs":{},"实":{"docs":{},"现":{"docs":{},"。":{"docs":{},"而":{"docs":{},"在":{"docs":{},"j":{"docs":{},"d":{"docs":{},"k":{"1":{"docs":{},".":{"6":{"docs":{},"后":{"docs":{},"，":{"docs":{},"j":{"docs":{},"a":{"docs":{},"v":{"docs":{},"a":{"docs":{},"就":{"docs":{},"用":{"docs":{},"了":{"docs":{},"一":{"docs":{},"堆":{"docs":{},"其":{"docs":{},"他":{"docs":{},"操":{"docs":{},"作":{"docs":{},"来":{"docs":{},"提":{"docs":{},"供":{"docs":{},"锁":{"docs":{},"性":{"docs":{},"能":{"docs":{},"的":{"docs":{},"操":{"docs":{},"作":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}},"docs":{}}},"docs":{}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"docs":{}}},"docs":{}}}}},"如":{"docs":{},"果":{"docs":{},"这":{"docs":{},"个":{"docs":{},"锁":{"docs":{},"对":{"docs":{},"象":{"docs":{},"逃":{"docs":{},"出":{"docs":{},"去":{"docs":{},"的":{"docs":{},"话":{"docs":{},"，":{"docs":{},"就":{"docs":{},"不":{"docs":{},"会":{"docs":{},"产":{"docs":{},"生":{"docs":{},"锁":{"docs":{},"消":{"docs":{},"除":{"docs":{},"。":{"docs":{},"比":{"docs":{},"如":{"docs":{},"：":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"偏":{"docs":{},"向":{"docs":{},"锁":{"docs":{},"：":{"docs":{},"一":{"docs":{},"直":{"docs":{},"以":{"docs":{},"来":{"docs":{},"都":{"docs":{},"是":{"docs":{},"同":{"docs":{},"一":{"docs":{},"个":{"docs":{},"线":{"docs":{},"程":{"docs":{},"获":{"docs":{},"取":{"docs":{},"这":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"，":{"docs":{},"则":{"docs":{},"这":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"就":{"docs":{},"变":{"docs":{},"成":{"docs":{},"偏":{"docs":{},"向":{"docs":{},"锁":{"docs":{},"；":{"docs":{},"如":{"docs":{},"果":{"docs":{},"下":{"docs":{},"次":{"docs":{},"还":{"docs":{},"是":{"docs":{},"这":{"docs":{},"个":{"docs":{},"线":{"docs":{},"程":{"docs":{},"获":{"docs":{},"取":{"docs":{},"我":{"docs":{},"，":{"docs":{},"也":{"docs":{},"不":{"docs":{},"需":{"docs":{},"要":{"docs":{},"去":{"docs":{},"获":{"docs":{},"取":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"其":{"docs":{},"中":{"docs":{},"，":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{},"就":{"docs":{},"是":{"docs":{},"监":{"docs":{},"视":{"docs":{},"器":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}},"字":{"docs":{},"节":{"docs":{},"码":{"docs":{},"上":{"docs":{},"会":{"docs":{},"多":{"docs":{},"出":{"docs":{},"俩":{"docs":{},"个":{"docs":{},"命":{"docs":{},"令":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}},"加":{"docs":{},"s":{"docs":{},"y":{"docs":{},"n":{"docs":{},"c":{"docs":{},"h":{"docs":{},"r":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"z":{"docs":{},"e":{"docs":{},"d":{"docs":{},"就":{"docs":{},"是":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"。":{"docs":{},"对":{"docs":{},"应":{"docs":{},"j":{"docs":{},"a":{"docs":{},"v":{"docs":{},"a":{"docs":{},"中":{"docs":{},"，":{"docs":{},"就":{"docs":{},"是":{"docs":{},"对":{"docs":{},"应":{"docs":{},"的":{"docs":{},"监":{"docs":{},"视":{"docs":{},"器":{"docs":{},"。":{"docs":{},"对":{"docs":{},"应":{"docs":{},"在":{"docs":{},"字":{"docs":{},"节":{"docs":{},"码":{"docs":{},"上":{"docs":{},"的":{"docs":{},"区":{"docs":{},"别":{"docs":{},"：":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"即":{"docs":{},"：":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{},"e":{"docs":{},"x":{"docs":{},"i":{"docs":{},"t":{"docs":{},"和":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{},"e":{"docs":{},"n":{"docs":{},"t":{"docs":{},"e":{"docs":{},"r":{"docs":{},"指":{"docs":{},"令":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"在":{"docs":{},"j":{"docs":{},"a":{"docs":{},"v":{"docs":{},"a":{"docs":{},"之":{"docs":{},"前":{"docs":{},"，":{"docs":{},"没":{"docs":{},"有":{"docs":{},"什":{"docs":{},"么":{"docs":{},"语":{"docs":{},"言":{"docs":{},"提":{"docs":{},"供":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"得":{"docs":{},"语":{"docs":{},"言":{"docs":{},"级":{"docs":{},"别":{"docs":{},"得":{"docs":{},"支":{"docs":{},"持":{"docs":{},"。":{"docs":{},"也":{"docs":{},"就":{"docs":{},"是":{"docs":{},"说":{"docs":{},"之":{"docs":{},"前":{"docs":{},"c":{"docs":{},"、":{"docs":{},"c":{"docs":{},"+":{"docs":{},"+":{"docs":{},"都":{"docs":{},"是":{"docs":{},"要":{"docs":{},"引":{"docs":{},"用":{"docs":{},"第":{"docs":{},"三":{"docs":{},"方":{"docs":{},"类":{"docs":{},"库":{"docs":{},"来":{"docs":{},"达":{"docs":{},"到":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"得":{"docs":{},"功":{"docs":{},"能":{"docs":{},"。":{"docs":{},"所":{"docs":{},"以":{"docs":{},"j":{"docs":{},"a":{"docs":{},"v":{"docs":{},"a":{"docs":{},"一":{"docs":{},"出":{"docs":{},"生":{"docs":{},"就":{"docs":{},"具":{"docs":{},"有":{"docs":{},"这":{"docs":{},"种":{"docs":{},"功":{"docs":{},"能":{"docs":{},"，":{"docs":{},"让":{"docs":{},"它":{"docs":{},"备":{"docs":{},"受":{"docs":{},"瞩":{"docs":{},"目":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"v":{"docs":{},"m":{"docs":{},"中":{"docs":{},"，":{"docs":{},"每":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"包":{"docs":{},"含":{"docs":{},"俩":{"docs":{},"部":{"docs":{},"分":{"docs":{},"：":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"、":{"docs":{},"对":{"docs":{},"象":{"docs":{},"数":{"docs":{},"据":{"docs":{},"。":{"docs":{},"其":{"docs":{},"中":{"docs":{},"对":{"docs":{},"象":{"docs":{},"数":{"docs":{},"据":{"docs":{},"就":{"docs":{},"是":{"docs":{},"我":{"docs":{},"们":{"docs":{},"写":{"docs":{},"代":{"docs":{},"码":{"docs":{},"能":{"docs":{},"看":{"docs":{},"到":{"docs":{},"的":{"docs":{},"属":{"docs":{},"性":{"docs":{},"之":{"docs":{},"类":{"docs":{},"的":{"docs":{},"东":{"docs":{},"西":{"docs":{},"，":{"docs":{},"而":{"docs":{},"在":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"中":{"docs":{},"含":{"docs":{},"有":{"docs":{},"包":{"docs":{},"含":{"docs":{},"同":{"docs":{},"步":{"docs":{},"相":{"docs":{},"关":{"docs":{},"信":{"docs":{},"息":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"如":{"docs":{},"果":{"docs":{},"同":{"docs":{},"一":{"docs":{},"个":{"docs":{},"锁":{"docs":{},"要":{"docs":{},"连":{"docs":{},"续":{"docs":{},"频":{"docs":{},"繁":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"、":{"docs":{},"解":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"就":{"docs":{},"会":{"docs":{},"粗":{"docs":{},"坏":{"docs":{},"为":{"docs":{},"更":{"docs":{},"大":{"docs":{},"范":{"docs":{},"围":{"docs":{},"的":{"docs":{},"锁":{"docs":{},"。":{"docs":{},"比":{"docs":{},"如":{"docs":{},"：":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"中":{"docs":{},"就":{"docs":{},"包":{"docs":{},"含":{"docs":{},"了":{"docs":{},"记":{"docs":{},"录":{"docs":{},"锁":{"docs":{},"的":{"docs":{},"标":{"docs":{},"志":{"docs":{},"位":{"docs":{},"。":{"docs":{},"如":{"docs":{},"下":{"docs":{},"图":{"docs":{},"：":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}},"的":{"docs":{},"定":{"docs":{},"义":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}},"的":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"的":{"docs":{},"碰":{"docs":{},"撞":{"docs":{},"过":{"docs":{},"程":{"docs":{},"，":{"docs":{},"其":{"docs":{},"实":{"docs":{},"是":{"docs":{},"多":{"docs":{},"线":{"docs":{},"程":{"docs":{},"环":{"docs":{},"境":{"docs":{},"中":{"docs":{},"，":{"docs":{},"针":{"docs":{},"对":{"docs":{},"不":{"docs":{},"同":{"docs":{},"环":{"docs":{},"境":{"docs":{},"下":{"docs":{},"，":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"变":{"docs":{},"化":{"docs":{},"的":{"docs":{},"过":{"docs":{},"程":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"无":{"docs":{},"锁":{"docs":{},"：":{"docs":{},"没":{"docs":{},"有":{"docs":{},"任":{"docs":{},"何":{"docs":{},"线":{"docs":{},"程":{"docs":{},"争":{"docs":{},"抢":{"docs":{},"这":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"，":{"docs":{},"则":{"docs":{},"这":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"就":{"docs":{},"变":{"docs":{},"成":{"docs":{},"无":{"docs":{},"锁":{"docs":{},"状":{"docs":{},"态":{"docs":{},"；":{"docs":{},"只":{"docs":{},"要":{"docs":{},"有":{"docs":{},"线":{"docs":{},"程":{"docs":{},"来":{"docs":{},"，":{"docs":{},"不":{"docs":{},"需":{"docs":{},"要":{"docs":{},"获":{"docs":{},"取":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{},"，":{"docs":{},"直":{"docs":{},"接":{"docs":{},"用":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"答":{"docs":{},"案":{"docs":{},"是":{"docs":{},"不":{"docs":{},"一":{"docs":{},"定":{"docs":{},"。":{"docs":{},"这":{"docs":{},"就":{"docs":{},"是":{"docs":{},"因":{"docs":{},"为":{"docs":{},"j":{"docs":{},"d":{"docs":{},"k":{"1":{"docs":{},".":{"6":{"docs":{},"所":{"docs":{},"做":{"docs":{},"的":{"docs":{},"优":{"docs":{},"化":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}},"docs":{}}},"docs":{}}}}}}}}}}}}}}}},"经":{"docs":{},"过":{"docs":{},"逃":{"docs":{},"逸":{"docs":{},"分":{"docs":{},"析":{"docs":{},"，":{"docs":{},"发":{"docs":{},"现":{"docs":{},"不":{"docs":{},"可":{"docs":{},"能":{"docs":{},"有":{"docs":{},"其":{"docs":{},"他":{"docs":{},"线":{"docs":{},"程":{"docs":{},"跟":{"docs":{},"我":{"docs":{},"竞":{"docs":{},"争":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"就":{"docs":{},"会":{"docs":{},"把":{"docs":{},"这":{"docs":{},"个":{"docs":{},"锁":{"docs":{},"消":{"docs":{},"除":{"docs":{},"掉":{"docs":{},"。":{"docs":{},"比":{"docs":{},"如":{"docs":{},"：":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"而":{"docs":{},"在":{"docs":{},"j":{"docs":{},"d":{"docs":{},"k":{"1":{"docs":{},".":{"6":{"docs":{},"，":{"docs":{},"对":{"docs":{},"锁":{"docs":{},"进":{"docs":{},"行":{"docs":{},"处":{"docs":{},"理":{"docs":{},"。":{"docs":{},"认":{"docs":{},"为":{"docs":{},"在":{"docs":{},"某":{"docs":{},"些":{"docs":{},"情":{"docs":{},"况":{"docs":{},"下":{"docs":{},"，":{"docs":{},"是":{"docs":{},"不":{"docs":{},"需":{"docs":{},"要":{"docs":{},"获":{"docs":{},"取":{"docs":{},"锁":{"docs":{},"也":{"docs":{},"可":{"docs":{},"以":{"docs":{},"达":{"docs":{},"到":{"docs":{},"线":{"docs":{},"程":{"docs":{},"安":{"docs":{},"全":{"docs":{},"目":{"docs":{},"的":{"docs":{},"，":{"docs":{},"在":{"docs":{},"特":{"docs":{},"定":{"docs":{},"情":{"docs":{},"况":{"docs":{},"下":{"docs":{},"，":{"docs":{},"再":{"docs":{},"让":{"docs":{},"线":{"docs":{},"程":{"docs":{},"获":{"docs":{},"取":{"docs":{},"锁":{"docs":{},"。":{"docs":{},"这":{"docs":{},"就":{"docs":{},"是":{"docs":{},"锁":{"docs":{},"的":{"docs":{},"膨":{"docs":{},"胀":{"docs":{},"过":{"docs":{},"程":{"docs":{},"。":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"docs":{}}},"docs":{}}}}}},"轻":{"docs":{},"量":{"docs":{},"锁":{"docs":{},"：":{"docs":{},"有":{"docs":{},"多":{"docs":{},"个":{"docs":{},"线":{"docs":{},"程":{"docs":{},"竞":{"docs":{},"争":{"docs":{},"的":{"docs":{},"情":{"docs":{},"况":{"docs":{},"发":{"docs":{},"生":{"docs":{},"，":{"docs":{},"但":{"docs":{},"在":{"docs":{},"绝":{"docs":{},"大":{"docs":{},"多":{"docs":{},"数":{"docs":{},"情":{"docs":{},"况":{"docs":{},"下":{"docs":{},"，":{"docs":{},"在":{"docs":{},"任":{"docs":{},"何":{"docs":{},"时":{"docs":{},"刻":{"docs":{},"，":{"docs":{},"都":{"docs":{},"只":{"docs":{},"有":{"docs":{},"一":{"docs":{},"个":{"docs":{},"线":{"docs":{},"程":{"docs":{},"来":{"docs":{},"获":{"docs":{},"取":{"docs":{},"这":{"docs":{},"个":{"docs":{},"锁":{"docs":{},"。":{"docs":{},"则":{"docs":{},"这":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"头":{"docs":{},"就":{"docs":{},"变":{"docs":{},"成":{"docs":{},"轻":{"docs":{},"量":{"docs":{},"锁":{"docs":{},"；":{"docs":{},"此":{"docs":{},"时":{"docs":{},"，":{"docs":{},"只":{"docs":{},"要":{"docs":{},"你":{"docs":{},"获":{"docs":{},"取":{"docs":{},"这":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"，":{"docs":{},"就":{"docs":{},"直":{"docs":{},"接":{"docs":{},"用":{"docs":{},"，":{"docs":{},"不":{"docs":{},"需":{"docs":{},"要":{"docs":{},"获":{"docs":{},"取":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"重":{"docs":{},"量":{"docs":{},"锁":{"docs":{},"：":{"docs":{},"在":{"docs":{},"同":{"docs":{},"一":{"docs":{},"时":{"docs":{},"刻":{"docs":{},"，":{"docs":{},"有":{"docs":{},"多":{"docs":{},"个":{"docs":{},"线":{"docs":{},"程":{"docs":{},"在":{"docs":{},"同":{"docs":{},"时":{"docs":{},"竞":{"docs":{},"争":{"docs":{},"锁":{"docs":{},"。":{"docs":{},"这":{"docs":{},"个":{"docs":{},"时":{"docs":{},"候":{"docs":{},"就":{"docs":{},"必":{"docs":{},"须":{"docs":{},"要":{"docs":{},"获":{"docs":{},"取":{"docs":{},"m":{"docs":{},"o":{"docs":{},"n":{"docs":{},"i":{"docs":{},"t":{"docs":{},"o":{"docs":{},"r":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"锁":{"docs":{},"膨":{"docs":{},"胀":{"docs":{},"的":{"docs":{},"过":{"docs":{},"程":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}}},"（":{"1":{"docs":{},"）":{"docs":{},"锁":{"docs":{},"粗":{"docs":{},"坏":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}},"2":{"docs":{},"）":{"docs":{},"锁":{"docs":{},"消":{"docs":{},"除":{"docs":{"multithreading/synchronized在jdk1.6的优化.html":{"ref":"multithreading/synchronized在jdk1.6的优化.html","tf":0.010638297872340425}}}}}}},"docs":{}}},"length":136},"corpusTokens":["\"test\"","(ljava/lang/string;)v","(lock){","(this){","...","//","0;","1","15","16","1、加synchronized跟不加有什么区别","2、进入monitorenter的时候，一定需要获取监视器吗？离开monitorexit的时候，一定要释放监视器吗？","3、锁粗化、锁细化：编译器层面的优化",":","=","aload","foo(){","for(int","getstat","introduct","invokevirtu","java/io/printstream.println","java/lang/system.out","l0","l5","ldc","linenumb","ljava/io/printstream;","lock","lock;","monitorent","monitorexit","new","object","object();","public","return","static","synchron","synchronized在jdk1.6的优化","system.out.println(\"test\");","test()v","test(){","void","}","以下是某个对象头锁的膨胀过程：","但是在jdk1.6之前，这种锁运行性能不高。因为synchronized是一种重量级别锁得实现。而在jdk1.6后，java就用了一堆其他操作来提供锁性能的操作。","但是如果这个锁对象逃出去的话，就不会产生锁消除。比如：","偏向锁：一直以来都是同一个线程获取这个对象，则这个对象头就变成偏向锁；如果下次还是这个线程获取我，也不需要去获取monitor","其中，monitor就是监视器。","其字节码上会多出俩个命令","加synchronized就是加锁。对应java中，就是对应的监视器。对应在字节码上的区别：","即：monitorexit和monitorenter指令。","在java之前，没有什么语言提供加锁得语言级别得支持。也就是说之前c、c++都是要引用第三方类库来达到加锁得功能。所以java一出生就具有这种功能，让它备受瞩目。","在jvm中，每个对象包含俩部分：对象头、对象数据。其中对象数据就是我们写代码能看到的属性之类的东西，而在对象头中含有包含同步相关信息。","如果同一个锁要连续频繁加锁、解锁，就会粗坏为更大范围的锁。比如：","对象头中就包含了记录锁的标志位。如下图：","对象头的定义","对象的对象头的碰撞过程，其实是多线程环境中，针对不同环境下，对象头变化的过程。","无锁：没有任何线程争抢这个对象，则这个对象头就变成无锁状态；只要有线程来，不需要获取monitor，直接用","答案是不一定。这就是因为jdk1.6所做的优化。","经过逃逸分析，发现不可能有其他线程跟我竞争锁，就会把这个锁消除掉。比如：","而在jdk1.6，对锁进行处理。认为在某些情况下，是不需要获取锁也可以达到线程安全目的，在特定情况下，再让线程获取锁。这就是锁的膨胀过程。","轻量锁：有多个线程竞争的情况发生，但在绝大多数情况下，在任何时刻，都只有一个线程来获取这个锁。则这个对象头就变成轻量锁；此时，只要你获取这个对象，就直接用，不需要获取monitor","重量锁：在同一时刻，有多个线程在同时竞争锁。这个时候就必须要获取monitor","锁膨胀的过程","（1）锁粗坏","（2）锁消除"],"pipeline":["stopWordFilter","stemmer"]},"store":{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction\n"},"multithreading/synchronized在jdk1.6的优化.html":{"url":"multithreading/synchronized在jdk1.6的优化.html","title":"synchronized在jdk1.6的优化","keywords":"","body":"在java之前，没有什么语言提供加锁得语言级别得支持。也就是说之前c、c++都是要引用第三方类库来达到加锁得功能。所以java一出生就具有这种功能，让它备受瞩目。\n但是在jdk1.6之前，这种锁运行性能不高。因为synchronized是一种重量级别锁得实现。而在jdk1.6后，java就用了一堆其他操作来提供锁性能的操作。 \n而在jdk1.6，对锁进行处理。认为在某些情况下，是不需要获取锁也可以达到线程安全目的，在特定情况下，再让线程获取锁。这就是锁的膨胀过程。\n1、加synchronized跟不加有什么区别\n加synchronized就是加锁。对应java中，就是对应的监视器。对应在字节码上的区别：\npublic void test(){\n    synchronized (this){\n        System.out.println(\"test\");\n    }\n}\n\n其字节码上会多出俩个命令\n  public test()V\n...\n    MONITORENTER\n   L0\n    LINENUMBER 15 L0\n    GETSTATIC java/lang/System.out : Ljava/io/PrintStream;\n    LDC \"test\"\n    INVOKEVIRTUAL java/io/PrintStream.println (Ljava/lang/String;)V\n   L5\n    LINENUMBER 16 L5\n    ALOAD 1\n    MONITOREXIT\n...\n\n即：MONITOREXIT和MONITORENTER指令。 其中，MONITOR就是监视器。 \n2、进入MONITORENTER的时候，一定需要获取监视器吗？离开MONITOREXIT的时候，一定要释放监视器吗？\n答案是不一定。这就是因为jdk1.6所做的优化。\n在JVM中，每个对象包含俩部分：对象头、对象数据。其中对象数据就是我们写代码能看到的属性之类的东西，而在对象头中含有包含同步相关信息。\n\n对象头的定义\n锁膨胀的过程\n\n对象头中就包含了记录锁的标志位。如下图：\n\n以下是某个对象头锁的膨胀过程：\n\n无锁：没有任何线程争抢这个对象，则这个对象头就变成无锁状态；只要有线程来，不需要获取monitor，直接用\n偏向锁：一直以来都是同一个线程获取这个对象，则这个对象头就变成偏向锁；如果下次还是这个线程获取我，也不需要去获取monitor\n轻量锁：有多个线程竞争的情况发生，但在绝大多数情况下，在任何时刻，都只有一个线程来获取这个锁。则这个对象头就变成轻量锁；此时，只要你获取这个对象，就直接用，不需要获取monitor\n重量锁：在同一时刻，有多个线程在同时竞争锁。这个时候就必须要获取monitor\n\n\n对象的对象头的碰撞过程，其实是多线程环境中，针对不同环境下，对象头变化的过程。\n\n3、锁粗化、锁细化：编译器层面的优化\n（1）锁粗坏\n如果同一个锁要连续频繁加锁、解锁，就会粗坏为更大范围的锁。比如：\n// monitorenter\nfor(int i = 0; i \n（2）锁消除\n经过逃逸分析，发现不可能有其他线程跟我竞争锁，就会把这个锁消除掉。比如：\npublic static void foo(){\n    Object lock = new Object();\n    synchronized (lock){\n        ...\n    }\n}\n\n但是如果这个锁对象逃出去的话，就不会产生锁消除。比如：\npublic static Object foo(){\n    Object lock = new Object();\n    synchronized (lock){\n        ...\n    }\n    return lock;\n}\n\n"}}}